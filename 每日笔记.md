roslaunch cartographer_ros lidar.launch
*********
```cpp
void ld_compute_cartesian(LDP ld)
{
    int i;
    for(i=0;i<ld->nrays;i++)
    {
        double x = cos(ld->theta[i]) * ld->readings[i];
        double y = sin(ld->theta[i]) * ld->readings[i];

        ld->points[i].p[0] = x, 
        ld->points[i].p[1] = y;
        ld->points[i].rho = GSL_NAN;
        ld->points[i].phi = GSL_NAN;
    }
}


void ld_compute_world_coords(LDP ld, const double *pose)
{
    double pose_x = pose[0];
    double pose_y = pose[1];
    double pose_theta = pose[2];
    double cos_theta = cos(pose_theta); 
    double sin_theta = sin(pose_theta);
    const int nrays = ld->nrays ;

    point2d * points = ld->points;
    point2d * points_w = ld->points_w;
    int i;
    for(i=0; i<nrays; i++)
    {
        if(!ld_valid_ray(ld,i))
            continue;
        double x0 = points[i].p[0],  y0 = points[i].p[1]; 
         // 省略: 判断x,y是否是nan
        // 算法第一步,获得帧yt的激光点在y(t-1)中的坐标
        points_w[i].p[0] = cos_theta * x0 -sin_theta*y0 + pose_x;
        points_w[i].p[1] = sin_theta * x0 +cos_theta*y0 + pose_y;
    }
    for(i=0;i<nrays;i++)
    {
        double x = points_w[i].p[0];
        double y = points_w[i].p[1];
        points_w[i].rho = sqrt( x*x+y*y);
        points_w[i].phi = atan2(y, x);
    }
}
```
********
```cpp
for (int j = 0; j < n ; j++)
    single_ldp->theta[j] = scan[i].min_angle + j * scan[i].angle_increment;
single_ldp->min_theta = single_ldp->theta[0];
single_ldp->max_theta = single_ldp->theta[n-1];
```
std::numeric_limits <float>::quiet_NaN ();可以得到浮点型的nan
************
```cpp
// Compute laser_sens's points in laser_ref's coordinates
//ld是params的laser_sens  pose就是params的first guess,全是0
void ld_compute_world_coords(LDP ld, const double *pose)
{
    double pose_x = pose[0];
    double pose_y = pose[1];
    double pose_theta = pose[2];
    double cos_theta = cos(pose_theta); 
    double sin_theta = sin(pose_theta);
    const int nrays = ld->nrays ;

    point2d * points = ld->points;
    point2d * points_w = ld->points_w;
    int i;
    for(i=0;i<nrays;i++)
    {
        if(!ld_valid_ray(ld,i)) continue;
        double x0 = points[i].p[0], 
               y0 = points[i].p[1];
        
        points_w[i].p[0] = cos_theta * x0 - sin_theta*y0 + pose_x;
        points_w[i].p[1] = sin_theta * x0 + cos_theta*y0 + pose_y;

        double x = points_w[i].p[0];
        double y = points_w[i].p[1];
        points_w[i].rho = sqrt( x*x+y*y);
        points_w[i].phi = atan2(y, x);
    }
}
```
*******
检查全局和局部代价地图所用的参数

雷达深度传感器，基于极坐标，可以持续的读取各个离散角度方向的深度。所谓地图配准问题，就是根据机器人的传感器测量数值来计算机器人的位姿，以此最好的适配地图。
*********************
机器人移动时，机器人位置在变化，激光雷达的位置也在变化，所以每一帧的雷达数据的坐标系都不同，需要将它们统一到同一个坐标系下。雷达数据的特征提取和匹配是机器人的初定位。
*********
`PointAccumulator`定义在smmap.h

for循环显然可以用OpenMP进行并行化，github上有OpenMP优化的gmapping
**********
八叉树地图特点
- 稀疏: 不需要对空间进行稠密切分
- 结构化: 方块排列固定,切分为八份
- 非直接索引查询

点云地图: 无序,因为它的点都是无序的,无法坐标索引查询;

改进提议分布和重采样步骤,在计算提议分布时不仅使用里程计信息,同时通过传感器的观测得到更精确估计,如果激光雷达精度很高,观测模型的可靠性就明显大于里程计模型. 引入自适应重采样,根据粒子权值自适应地保留优良粒子以改善粒子贫乏问题.

如何确定gmapping的粒子缺乏问题
*********
近似误差：Approximation Error，指的是选择的模型并不适合当前数据所造成的误差

在每个时间点k,粒子是从提议分布中获取,以近似真实的分布,粒子被赋予权重以弥补误差.但近似误差是会随时间而增长的,也增加了粒子权重的偏差,不利于统计的准确性. 所以才有了重采样


GridSlamProcessor::scanMatch     (gridslamprocessor.hxx)

ScanMatcher::optimize             (scanmatcher.cpp)

ScanMatcher::score                (scanmatcher.h)



m_laserPose赋值在setLaserParameters,表示laser在base_link坐标系中的坐标

m_initialBeamsSkip: 开始跳过的激光束,获得激光得分时,从下标m_initialBeamsSkip的激光束开始


金坛河滨小学 0519－82837968
********
1. 进入[informatik.uni-freiburg](http://ais.informatik.uni-freiburg.de/slamevaluation/datasets.php)选择`download log file`下载数据集
2. 看到一个文本网页,另存下载或者新建一個文件如data.clf保存.注意是.clf格式
3. 这个clf文件显然不是我们想要的,可以转换为bag文件. 使用[clf_to_bag.py](https://github.com/charon-cheung/xiaoqiang_robot/blob/master/clf_to_bag.py)
*******













https://www1318.o0-3.com/token=URMdk_JY5V2OXoXYmDPG_g/1592641735/1.65.0.0/104/d/23/54fe4fac7c4af4b5c34e0f5e216f623d-720p.mp4

https://www604.o0-2.com/token=b5BtXbA7BeaBsz5ebQtsUw/1592641746/1.65.0.0/79/7/1f/e646c06e405d0962510e80ec7512b1f7-720p.mp4

https://www1169.o0-3.com/token=6376QHcnzksaszWzXo7A-g/1592641740/1.65.0.0/96/2/d3/d8e0d102aa0c854a53c1144733342d32-720p.mp4

https://www1289.o0-3.com/token=z-o_Kw_akCJctGdcfUeIKQ/1592641738/1.65.0.0/74/5/9c/23b80a131aaf74c917c27390ea75d9c5-720p.mp4

https://www782.o0-2.com/token=nBJR20apq_8faq46GL1x-g/1592642477/1.65.0.0/114/0/d3/15c39b15bd90047781e7cc95a0b2ed30-720p.mp4

https://www324.o0-1.com/token=Qo_ACIN7djRnHRto8T88gw/1592642813/1.65.0.0/127/0/ff/447cb5dff64904200ecbc13ccc76cff0-720p.mp4

https://www1319.o0-3.com/token=6iRdtHw1oIGBYA2BK1D85w/1592642815/1.65.0.0/93/7/1d/78930baf66df31e9353d0b7e99bd21d7-720p.mp4

https://www2120.o0-5.com/token=Ek16eXZJ9wsnJVMfKaulWg/1592643075/1.65.0.0/15/5/8e/4b7bc79de4b08203cb455580be1218e5-720p.mp4

https://www1303.o0-3.com/token=xBZKZ4LmnptUmPVA-phguQ/1592643077/1.65.0.0/74/1/dc/684dce91146b540b1aba7ef5f6261dc1-720p.mp4

https://www1637.o0-4.com/token=n6ZQGy8pbH6RQ24z8y0ueA/1592643243/1.65.0.0/118/c/1d/3e6e88a7bc30bf1e351974faa6e051dc-720p.mp4

https://www1671.o0-4.com/token=U8Twzfr12b48rNKoQzR58g/1592643240/1.65.0.0/87/c/58/b213c21c2f5dfb52cd933c621dd4358c-720p.mp4

https://www33.o0-1.com/token=rv8XalfHYI7EcpA_tZCuWQ/1592643149/1.65.0.0/110/3/50/3e0498cdeca98089de74dc58095c7503-720p.mp4

https://www1424.o0-3.com/token=Kn40DbpHFSlEgtvpBnsDhQ/1592643432/1.65.0.0/94/d/36/c6aed2ae8cdac042356792679240d36d-720p.mp4

https://www52.o0-1.com/token=mVESq8qBJ09aj1kxh9CvOQ/1592643432/1.65.0.0/39/c/2e/52135f0521a2df7f64b475bc7a8562ec-720p.mp4


https://www2006.o0-5.com/token=GUA1zzvpb0V5vq0k-FjShw/1592644121/1.65.0.0/53/a/88/28ed52370f10168240e82dd6df42488a-720p.mp4